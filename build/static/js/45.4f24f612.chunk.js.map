{"version":3,"sources":["pages/auth/RegisterComplete.js"],"names":["RegisterComplete","history","useState","email","setEmail","password","setPassword","dispatch","useDispatch","useEffect","window","localStorage","getItem","handleSubmit","e","a","toast","error","length","signInWithEmailLink","auth","location","href","user","emailVerified","removeItem","currentUser","updatePassword","getIdTokenResult","idTokenResult","createOrUpdateUser","token","then","res","type","payload","name","data","role","_id","catch","err","console","log","push","message","validate","preventDefault","val_pass","document","getElementById","value","pass_valid","innerText","style","display","className","disabled","id","onChange","target","placeholder","autoFocus","onClick"],"mappings":"oMA+IeA,UAxIU,SAAC,GAAiB,IAAfC,EAAc,EAAdA,QAC1B,EAA0BC,mBAAS,IAAnC,mBAAOC,EAAP,KAAcC,EAAd,KACA,EAAgCF,mBAAS,IAAzC,mBAAOG,EAAP,KAAiBC,EAAjB,KAGIC,EAAWC,cAEfC,qBAAU,WACRL,EAASM,OAAOC,aAAaC,QAAQ,2BAIpC,IAEH,IAAMC,EAAY,uCAAG,WAAOC,GAAP,iBAAAC,EAAA,yDAIdZ,GAAUE,EAJI,uBAKjBW,IAAMC,MAAM,kCALK,+BASfZ,EAASa,OAAS,GATH,uBAUjBF,IAAMC,MAAM,8CAVK,mDAeIE,YAAoBC,IACvCjB,EACAO,OAAOW,SAASC,MAjBD,kBAsBNC,KAAKC,cAtBC,wBAyBfd,OAAOC,aAAac,WAAW,wBAI3BF,EAAOH,IAAKM,YA7BD,UA+BTC,YAAeJ,EAAKlB,GA/BX,yBAiCakB,EAAKK,mBAjClB,QAiCTC,EAjCS,OAuCfC,YAAmBD,EAAcE,OAC9BC,MAAK,SAACC,GACL1B,EAAS,CACP2B,KAAM,iBAENC,QAAS,CACPC,KAAMH,EAAII,KAAKD,KACfjC,MAAO8B,EAAII,KAAKlC,MAChB4B,MAAOF,EAAcE,MACrBO,KAAML,EAAII,KAAKC,KACfC,IAAKN,EAAII,KAAKE,UAInBC,OAAM,SAAAC,GAAG,OAAEC,QAAQC,IAAIF,MAI1BxC,EAAQ2C,KAAK,KAzDE,0DA6DjB5B,IAAMC,MAAM,KAAM4B,SA7DD,0DAAH,sDAiEZC,EAAW,SAAChC,GAChBA,EAAEiC,iBAEF,IAAIC,EAAWC,SAASC,eAAe,QAAQC,MAE3CC,GAAa,EAEJ,IAAVJ,GACDC,SAASC,eAAe,WAAWG,UAAY,+BAC/CD,GAAa,IACLJ,EAAS9B,OAAO,GACxB+B,SAASC,eAAe,WAAWG,UAAY,yCAC/CD,GAAa,IAEbH,SAASC,eAAe,WAAWI,MAAMC,QAAU,OACnDH,GAAa,GAGZA,GACDvC,KA0BJ,OACE,qBAAK2C,UAAU,gBAAf,SACE,qBAAKA,UAAU,MAAf,SACE,sBAAKA,UAAU,6BAAf,UACA,oBAAIA,UAAU,kCAAd,+BAxBJ,iCACE,uBAAOtB,KAAK,QAAQsB,UAAU,eAAeL,MAAOhD,EAAOsD,UAAQ,IACnE,uBACEC,GAAG,OACHxB,KAAK,WACLsB,UAAU,0BACVL,MAAO9C,EACPsD,SAAU,SAAC7C,GAAD,OAAOR,EAAYQ,EAAE8C,OAAOT,QACtCU,YAAY,WACZC,WAAS,IAEX,sBAAMJ,GAAG,UAAUF,UAAU,gBAC5B,qBAAKA,UAAU,gCAAf,SACD,wBAAQO,QAASjB,EAAUU,UAAU,iDAArC","file":"static/js/45.4f24f612.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { auth } from \"../../firebase\";\nimport { signInWithEmailLink, updatePassword } from \"@firebase/auth\";\nimport { toast } from \"react-toastify\";\nimport { useDispatch} from \"react-redux\";\nimport { createOrUpdateUser } from \"../../functions/auth\";\n\nconst RegisterComplete = ({ history }) => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  // const { user } = useSelector((state) => ({ ...state }));\n  let dispatch = useDispatch();\n\n  useEffect(() => {\n    setEmail(window.localStorage.getItem(\"emailForRegistration\"));\n\n    // console.log(window.location.href);\n    // console.log(window.localStorage.getItem('emailForRegistration'));\n  }, []);\n\n  const handleSubmit = async (e) => {\n\n    // validation\n\n    if (!email || !password) {\n      toast.error(\"Email and Password is required\");\n      return;\n    }\n\n    if (password.length < 6) {\n      toast.error(\"Password must be atleast 6 characters long\");\n      return;\n    }\n\n    try {\n      const result = await signInWithEmailLink(auth,\n        email,\n        window.location.href\n      );\n\n      // console.log('RESULT', result);\n\n      if (result.user.emailVerified) {\n        //remove user email from localStorage\n\n        window.localStorage.removeItem(\"emailForRegistration\");\n\n        //get user id token\n\n        let user = auth.currentUser;\n\n        await updatePassword(user,password);\n\n        const idTokenResult = await user.getIdTokenResult();\n\n        //redux store\n\n        // console.log(\"user\", user, \"idTokenResult\", idTokenResult);\n\n        createOrUpdateUser(idTokenResult.token)\n          .then((res) => {\n            dispatch({\n              type: \"LOGGED_IN_USER\",\n\n              payload: {\n                name: res.data.name,\n                email: res.data.email,\n                token: idTokenResult.token,\n                role: res.data.role,\n                _id: res.data._id,\n              },\n            });\n          })\n          .catch(err=>console.log(err));\n\n        //redirect\n\n        history.push(\"/\");\n      }\n    } catch (error) {\n      // console.log(error);\n      toast.error(error.message);\n    }\n  };\n\n  const validate = (e) =>{\n    e.preventDefault()\n\n    var val_pass = document.getElementById(\"pass\").value\n\n    let pass_valid = false\n\n    if(val_pass==\"\"){\n      document.getElementById('errPass').innerText = \"This field must not be empty\"\n      pass_valid = false\n    }else if(!val_pass.length>6){\n      document.getElementById('errPass').innerText = \"Password must be atleast 6 characters.\"\n      pass_valid = false\n    }else{\n      document.getElementById('errPass').style.display = 'none'\n      pass_valid = true\n    }\n    \n    if(pass_valid){\n      handleSubmit()\n    }\n\n}\n\n  const completeRegistrationForm = () => (\n    <form>\n      <input type=\"email\" className=\"form-control\" value={email} disabled />\n      <input\n        id=\"pass\"\n        type=\"password\"\n        className=\"form-control grad-input\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        placeholder=\"Password\"\n        autoFocus\n      />\n      <span id='errPass' className=\"text-danger\"></span>\n       <div className=\"d-flex justify-content-center\">\n      <button onClick={validate} className=\"btn btn-raised p-2 grad-button text-white shaw\">\n        Complete Registration\n      </button>\n      </div>\n    </form>\n  );\n\n  return (\n    <div className=\"container p-5\">\n      <div className=\"row\">\n        <div className=\"col-md-6 offset-md-3 mt-5 \">\n        <h4 className=\"text-center text-secondary shaw\">Register Complete</h4>\n        {completeRegistrationForm()}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RegisterComplete;\n"],"sourceRoot":""}